import VueDiff2Html from 'src/VueDiff2Html.vue'
import { createVM } from '../helpers/utils.js'

describe('VueDiff2Html.vue', function () {
  it('should render correct contents', function () {
    const vm = createVM(this, `
<VueDiff2Html :jsonDiff="jsonDiff"></VueDiff2Html>
`, {
      components: { VueDiff2Html },
      data() {
        return {
          jsonDiff: JSON.parse('[{"blocks":[{"lines":[{"content":"       \\"https://jumpagrade.com\\",","type":"d2h-cntx","oldNumber":5,"newNumber":5},{"content":"       \\"https://student.jumpagrade.com\\",","type":"d2h-cntx","oldNumber":6,"newNumber":6},{"content":"       \\"https://parent.jumpagrade.com\\",","type":"d2h-cntx","oldNumber":7,"newNumber":7},{"content":"-      \\"https://jag-fire-test.firebaseapp.com\\",","type":"d2h-del","oldNumber":8,"newNumber":null},{"content":"-      \\"https://jag-fire-admin.firebaseapp.com\\"","type":"d2h-del","oldNumber":9,"newNumber":null},{"content":"+      \\"https://jag-fire-test.firebaseapp.com\\"","type":"d2h-ins","oldNumber":null,"newNumber":8},{"content":"     ],","type":"d2h-cntx","oldNumber":10,"newNumber":9},{"content":"     \\"method\\": [\\"GET\\", \\"POST\\", \\"OPTIONS\\"],","type":"d2h-cntx","oldNumber":11,"newNumber":10},{"content":"     \\"responseHeader\\": [\\"Content-Type\\"],","type":"d2h-cntx","oldNumber":12,"newNumber":11}],"oldStartLine":"5","oldStartLine2":null,"newStartLine":"5","header":"@@ -5,8 +5,7 @@"}],"deletedLines":2,"addedLines":1,"isGitDiff":true,"checksumBefore":"3f7a8f1","checksumAfter":"c606f25","mode":"100644","oldName":"functions/cors.json","language":"json","newName":"functions/cors.json","isCombined":false},{"blocks":[{"lines":[{"content":" const mailSend = require(\'../utils/mail-send\');","type":"d2h-cntx","oldNumber":3,"newNumber":3},{"content":" const responseSuccess = require(\'../utils/response-success\');","type":"d2h-cntx","oldNumber":4,"newNumber":4},{"content":" ","type":"d2h-cntx","oldNumber":5,"newNumber":5},{"content":"-module.exports = (req, res, admin) => {","type":"d2h-del","oldNumber":6,"newNumber":null},{"content":"-  const { uid } = req.body;","type":"d2h-del","oldNumber":7,"newNumber":null},{"content":"+module.exports = (req, res, admin, uid) => {","type":"d2h-ins","oldNumber":null,"newNumber":6},{"content":"   return admin.database().ref(`/studentToParent/${uid}`).once(\'value\', (snapshot) => {","type":"d2h-cntx","oldNumber":8,"newNumber":7},{"content":"     const parentUid = snapshot.val();","type":"d2h-cntx","oldNumber":9,"newNumber":8},{"content":" ","type":"d2h-cntx","oldNumber":10,"newNumber":9}],"oldStartLine":"3","oldStartLine2":null,"newStartLine":"3","header":"@@ -3,8 +3,7 @@ const hash = require(\'promise-hash\');"}],"deletedLines":2,"addedLines":1,"isGitDiff":true,"checksumBefore":"eab780f","checksumAfter":"b300bf7","mode":"100644","oldName":"functions/modules/http-admin-protected-feedback-added.js","language":"js","newName":"functions/modules/http-admin-protected-feedback-added.js","isCombined":false},{"blocks":[{"lines":[{"content":" \'use strict\';","type":"d2h-cntx","oldNumber":1,"newNumber":1},{"content":" ","type":"d2h-cntx","oldNumber":2,"newNumber":2},{"content":" const responseSuccess = require(\'../utils/response-success\');","type":"d2h-cntx","oldNumber":3,"newNumber":3},{"content":"-const hash = require(\'promise-hash\');","type":"d2h-del","oldNumber":4,"newNumber":null},{"content":" ","type":"d2h-cntx","oldNumber":5,"newNumber":4},{"content":" module.exports = (req, res, admin) => {","type":"d2h-cntx","oldNumber":6,"newNumber":5},{"content":"-  return hash({","type":"d2h-del","oldNumber":7,"newNumber":null},{"content":"-    listUsersResult: admin.auth().listUsers(1000),","type":"d2h-del","oldNumber":8,"newNumber":null},{"content":"-    usersTypesSnapshot: admin.database().ref(\'/userType\').once(\'value\')","type":"d2h-del","oldNumber":9,"newNumber":null},{"content":"-  }).then(({ listUsersResult, usersTypesSnapshot }) => {","type":"d2h-del","oldNumber":10,"newNumber":null},{"content":"-    const userTypes = usersTypesSnapshot.val();","type":"d2h-del","oldNumber":11,"newNumber":null},{"content":"-    const getUserType = (userUid) => {","type":"d2h-del","oldNumber":12,"newNumber":null},{"content":"-      if (typeof userTypes[userUid] === \'string\') {","type":"d2h-del","oldNumber":13,"newNumber":null},{"content":"-        return userTypes[userUid];","type":"d2h-del","oldNumber":14,"newNumber":null},{"content":"-      }","type":"d2h-del","oldNumber":15,"newNumber":null},{"content":"-      return \'student\';","type":"d2h-del","oldNumber":16,"newNumber":null},{"content":"-    };","type":"d2h-del","oldNumber":17,"newNumber":null},{"content":"+  return admin.auth().listUsers(1000)","type":"d2h-ins","oldNumber":null,"newNumber":6},{"content":"+    .then((listUsersResult) => {","type":"d2h-ins","oldNumber":null,"newNumber":7},{"content":"+      const mappedUsers = listUsersResult.users.map((userRecord) => {","type":"d2h-ins","oldNumber":null,"newNumber":8},{"content":"+        const { email, displayName, uid } = userRecord.toJSON();","type":"d2h-ins","oldNumber":null,"newNumber":9},{"content":" ","type":"d2h-cntx","oldNumber":18,"newNumber":10},{"content":"-    const mappedUsers = listUsersResult.users.map((userRecord) => {","type":"d2h-del","oldNumber":19,"newNumber":null},{"content":"-      const { email, displayName, uid } = userRecord.toJSON();","type":"d2h-del","oldNumber":20,"newNumber":null},{"content":"+        return { email, displayName, uid }","type":"d2h-ins","oldNumber":null,"newNumber":11},{"content":"+      });","type":"d2h-ins","oldNumber":null,"newNumber":12},{"content":" ","type":"d2h-cntx","oldNumber":21,"newNumber":13},{"content":"-      return { email, displayName, uid, type: getUserType(uid) }","type":"d2h-del","oldNumber":22,"newNumber":null},{"content":"+      return responseSuccess(res, mappedUsers);","type":"d2h-ins","oldNumber":null,"newNumber":14},{"content":"     });","type":"d2h-cntx","oldNumber":23,"newNumber":15},{"content":"-","type":"d2h-del","oldNumber":24,"newNumber":null},{"content":"-    return responseSuccess(res, mappedUsers);","type":"d2h-del","oldNumber":25,"newNumber":null},{"content":"-  });","type":"d2h-del","oldNumber":26,"newNumber":null},{"content":" };","type":"d2h-cntx","oldNumber":27,"newNumber":16}],"oldStartLine":"1","oldStartLine2":null,"newStartLine":"1","header":"@@ -1,27 +1,16 @@"}],"deletedLines":18,"addedLines":7,"isGitDiff":true,"checksumBefore":"ebe9327","checksumAfter":"1b693a4","mode":"100644","oldName":"functions/modules/http-admin-protected-list-users.js","language":"js","newName":"functions/modules/http-admin-protected-list-users.js","isCombined":false},{"blocks":[{"lines":[{"content":" const mailSend = require(\'../utils/mail-send\');","type":"d2h-cntx","oldNumber":3,"newNumber":3},{"content":" const responseSuccess = require(\'../utils/response-success\');","type":"d2h-cntx","oldNumber":4,"newNumber":4},{"content":" ","type":"d2h-cntx","oldNumber":5,"newNumber":5},{"content":"-module.exports = (req, res, admin) => {","type":"d2h-del","oldNumber":6,"newNumber":null},{"content":"-  const { uid } = req.body;","type":"d2h-del","oldNumber":7,"newNumber":null},{"content":"+module.exports = (req, res, admin, uid) => {","type":"d2h-ins","oldNumber":null,"newNumber":6},{"content":"   return admin.database().ref(`/studentToParent/${uid}`).once(\'value\', (snapshot) => {","type":"d2h-cntx","oldNumber":8,"newNumber":7},{"content":"     const parentUid = snapshot.val();","type":"d2h-cntx","oldNumber":9,"newNumber":8},{"content":" ","type":"d2h-cntx","oldNumber":10,"newNumber":9}],"oldStartLine":"3","oldStartLine2":null,"newStartLine":"3","header":"@@ -3,8 +3,7 @@ const hash = require(\'promise-hash\');"}],"deletedLines":2,"addedLines":1,"isGitDiff":true,"checksumBefore":"5f51273","checksumAfter":"4684552","mode":"100644","oldName":"functions/modules/http-admin-protected-worksheet-added.js","language":"js","newName":"functions/modules/http-admin-protected-worksheet-added.js","isCombined":false},{"blocks":[{"lines":[{"content":" \'use strict\';","type":"d2h-cntx","oldNumber":1,"newNumber":1},{"content":" ","type":"d2h-cntx","oldNumber":2,"newNumber":2},{"content":"-const responseSuccess = require(\'../utils/response-success\');","type":"d2h-del","oldNumber":3,"newNumber":null},{"content":"-","type":"d2h-del","oldNumber":4,"newNumber":null},{"content":" module.exports = (req, res, admin) => {","type":"d2h-cntx","oldNumber":5,"newNumber":3},{"content":"   const { uid } = req.body;","type":"d2h-cntx","oldNumber":6,"newNumber":4},{"content":" ","type":"d2h-cntx","oldNumber":7,"newNumber":5},{"content":"+  res.set({","type":"d2h-ins","oldNumber":null,"newNumber":6},{"content":"+    \'Access-Control-Allow-Origin\': req.get(\'Origin\'),","type":"d2h-ins","oldNumber":null,"newNumber":7},{"content":"+    \'Access-Control-Allow-Method\': \'GET\',","type":"d2h-ins","oldNumber":null,"newNumber":8},{"content":"+    \'Access-Control-Allow-Headers\': \'content-type\',","type":"d2h-ins","oldNumber":null,"newNumber":9},{"content":"+  });","type":"d2h-ins","oldNumber":null,"newNumber":10},{"content":"+","type":"d2h-ins","oldNumber":null,"newNumber":11},{"content":"+  //respond to CORS preflight requests","type":"d2h-ins","oldNumber":null,"newNumber":12},{"content":"+  if (req.method === \'OPTIONS\') {","type":"d2h-ins","oldNumber":null,"newNumber":13},{"content":"+    return res.status(200).send();","type":"d2h-ins","oldNumber":null,"newNumber":14},{"content":"+  }","type":"d2h-ins","oldNumber":null,"newNumber":15},{"content":"+","type":"d2h-ins","oldNumber":null,"newNumber":16},{"content":"   if (!uid) {","type":"d2h-cntx","oldNumber":8,"newNumber":17},{"content":"     return res.status(400).send(\'No uid submitted!\');","type":"d2h-cntx","oldNumber":9,"newNumber":18},{"content":"   }","type":"d2h-cntx","oldNumber":10,"newNumber":19},{"content":" ","type":"d2h-cntx","oldNumber":11,"newNumber":20},{"content":"-  return admin.auth().getUser(uid).then((userRecord) => responseSuccess(res, {","type":"d2h-del","oldNumber":12,"newNumber":null},{"content":"-    parentEmail: userRecord.email","type":"d2h-del","oldNumber":13,"newNumber":null},{"content":"-  }));","type":"d2h-del","oldNumber":14,"newNumber":null},{"content":"+  return admin.auth().getUser(uid).then((userRecord) => {","type":"d2h-ins","oldNumber":null,"newNumber":21},{"content":"+    return res.status(200).send(userRecord.email)","type":"d2h-ins","oldNumber":null,"newNumber":22},{"content":"+  });","type":"d2h-ins","oldNumber":null,"newNumber":23},{"content":" };","type":"d2h-cntx","oldNumber":15,"newNumber":24}],"oldStartLine":"1","oldStartLine2":null,"newStartLine":"1","header":"@@ -1,15 +1,24 @@"}],"deletedLines":5,"addedLines":14,"isGitDiff":true,"checksumBefore":"575a1da","checksumAfter":"b402ff6","mode":"100644","oldName":"functions/modules/http-get-user-email.js","language":"js","newName":"functions/modules/http-get-user-email.js","isCombined":false},{"blocks":[{"lines":[{"content":" \'use strict\';","type":"d2h-cntx","oldNumber":1,"newNumber":1},{"content":" ","type":"d2h-cntx","oldNumber":2,"newNumber":2},{"content":" const responseSuccess = require(\'../utils/response-success\');","type":"d2h-cntx","oldNumber":3,"newNumber":3},{"content":"-const hash = require(\'promise-hash\');","type":"d2h-del","oldNumber":4,"newNumber":null},{"content":" ","type":"d2h-cntx","oldNumber":5,"newNumber":4},{"content":" module.exports = (req, res, admin, uid) => {","type":"d2h-cntx","oldNumber":6,"newNumber":5},{"content":"   return admin.database().ref(\'/studentToParent\').once(\'value\', (snapshot) => {","type":"d2h-cntx","oldNumber":7,"newNumber":6}],"oldStartLine":"1","oldStartLine2":null,"newStartLine":"1","header":"@@ -1,7 +1,6 @@"},{"lines":[{"content":"         const mappedUsersPromises = listUsersResult.users.filter(st => (parentStudents.indexOf(st.uid) + 1)).map((userRecord) => {","type":"d2h-cntx","oldNumber":14,"newNumber":13},{"content":"           return new Promise((resolve) => {","type":"d2h-cntx","oldNumber":15,"newNumber":14},{"content":"             const { email, displayName, uid } = userRecord.toJSON();","type":"d2h-cntx","oldNumber":16,"newNumber":15},{"content":"-            return hash({","type":"d2h-del","oldNumber":17,"newNumber":null},{"content":"-              activitySnapshot: admin.database().ref(`/activity/${uid}`).orderByKey().once(\'value\'),","type":"d2h-del","oldNumber":18,"newNumber":null},{"content":"-              settingsSnapshot: admin.database().ref(`/userSettings/${uid}`).once(\'value\'),","type":"d2h-del","oldNumber":19,"newNumber":null},{"content":"-            }).then(({ activitySnapshot, settingsSnapshot }) => {","type":"d2h-del","oldNumber":20,"newNumber":null},{"content":"-              const activityValues = activitySnapshot.val();","type":"d2h-del","oldNumber":21,"newNumber":null},{"content":"-              const settingsValue = settingsSnapshot.val();","type":"d2h-del","oldNumber":22,"newNumber":null},{"content":"+            admin.database().ref(`/activity/${uid}`).orderByKey().once(\'value\', (s) => {","type":"d2h-ins","oldNumber":null,"newNumber":16},{"content":"+              const values = s.val();","type":"d2h-ins","oldNumber":null,"newNumber":17},{"content":"               let lastActive = null;","type":"d2h-cntx","oldNumber":23,"newNumber":18},{"content":"-              let trialExpirationDate = null;","type":"d2h-del","oldNumber":24,"newNumber":null},{"content":"-              let accountExpirationDate = null;","type":"d2h-del","oldNumber":25,"newNumber":null},{"content":" ","type":"d2h-cntx","oldNumber":26,"newNumber":19},{"content":"-              if (activityValues) {","type":"d2h-del","oldNumber":27,"newNumber":null},{"content":"-                const firstKey = Object.keys(activityValues).reverse()[0];","type":"d2h-del","oldNumber":28,"newNumber":null},{"content":"-                const lastItem = Object.keys(activityValues[firstKey]).reverse()[0];","type":"d2h-del","oldNumber":29,"newNumber":null},{"content":"-                lastActive = activityValues[firstKey][lastItem].end;","type":"d2h-del","oldNumber":30,"newNumber":null},{"content":"+              if (values) {","type":"d2h-ins","oldNumber":null,"newNumber":20},{"content":"+                const firstKey = Object.keys(values).reverse()[0];","type":"d2h-ins","oldNumber":null,"newNumber":21},{"content":"+                const lastItem = Object.keys(values[firstKey]).reverse()[0];","type":"d2h-ins","oldNumber":null,"newNumber":22},{"content":"+                lastActive = values[firstKey][lastItem].end;","type":"d2h-ins","oldNumber":null,"newNumber":23},{"content":"               }","type":"d2h-cntx","oldNumber":31,"newNumber":24},{"content":" ","type":"d2h-cntx","oldNumber":32,"newNumber":25},{"content":"-              if (settingsValue) {","type":"d2h-del","oldNumber":33,"newNumber":null},{"content":"-                trialExpirationDate = settingsValue.trialExpirationDate;","type":"d2h-del","oldNumber":34,"newNumber":null},{"content":"-                accountExpirationDate = settingsValue.accountExpirationDate;","type":"d2h-del","oldNumber":35,"newNumber":null},{"content":"-              }","type":"d2h-del","oldNumber":36,"newNumber":null},{"content":"-","type":"d2h-del","oldNumber":37,"newNumber":null},{"content":"-              resolve({ email, displayName, uid, lastActive, trialExpirationDate, accountExpirationDate });","type":"d2h-del","oldNumber":38,"newNumber":null},{"content":"+              resolve({ email, displayName, uid, lastActive });","type":"d2h-ins","oldNumber":null,"newNumber":26},{"content":"             });","type":"d2h-cntx","oldNumber":39,"newNumber":27},{"content":"           });","type":"d2h-cntx","oldNumber":40,"newNumber":28},{"content":"         });","type":"d2h-cntx","oldNumber":41,"newNumber":29}],"oldStartLine":"14","oldStartLine2":null,"newStartLine":"13","header":"@@ -14,28 +13,17 @@ module.exports = (req, res, admin, uid) => {"}],"deletedLines":19,"addedLines":7,"isGitDiff":true,"checksumBefore":"0bbf91c","checksumAfter":"95f2fac","mode":"100644","oldName":"functions/modules/http-protected-get-parent-users.js","language":"js","newName":"functions/modules/http-protected-get-parent-users.js","isCombined":false}]')
        };
      }
    })
    vm.$el.querySelector('h1').textContent.should.persist
  })
})
